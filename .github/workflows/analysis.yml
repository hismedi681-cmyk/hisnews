name: Double Helix News Analysis Pipeline

on:
  schedule:
    - cron: '0 0 * * *' # 매일 자정 자동 실행 (필요시 수정)
  workflow_dispatch:      # 수동 실행 버튼 활성화

jobs:
  run-analysis:
    runs-on: ubuntu-latest

    env:
      # GitHub Secrets에서 가져와 환경 변수로 매핑
      GOOGLE_SERVICE_ACCOUNT_JSON: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}
      BQ_PROJECT_ID: ${{ secrets.BQ_PROJECT_ID }}
      BQ_DATASET_ID: "kinetic_field"
      GCP_LOCATION: "asia-northeast3" # 서울 리전
      BQ_RAW_TABLE: "raw_stream_native"
      BQ_RESULT_TABLE: "fmo_final_analysis"

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-directory: '.'
          python-version: '3.13'

      - name: Install Dependencies
        run: |
          pip install google-cloud-bigquery google-cloud-aiplatform google-auth

      - name: Run Double Helix Analyzer
        run: python analyzer.py
